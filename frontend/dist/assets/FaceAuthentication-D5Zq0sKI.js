import{i as d,j as e,r as i,B as t,T as r,A as Z,C as ee,F as be}from"./index-CQi3PHFX.js";import{b as ye,R as _e,d as Se,a as Ce}from"./react-webcam-BH7rRv44.js";import{r as x,d as B}from"./CheckCircle-DODlBGN0.js";import{u as Ie}from"./useTheme-BwfxRj1I.js";import{u as Re}from"./useMediaQuery-DXyRXirw.js";import{C as _}from"./Card-ZxPpsMTE.js";import{C as S}from"./CardContent-LfaozUcB.js";import{D as te}from"./Divider-dYpdDvre.js";import{B as re}from"./Button-C5D5G1VZ.js";import"./ownerWindow-CN4f4NkX.js";import"./debounce-Be36O1Ab.js";import"./useControlled-VN5YBWhF.js";import"./dividerClasses-DtBGEAXD.js";var E={},Me=d;Object.defineProperty(E,"__esModule",{value:!0});var ae=E.default=void 0,we=Me(x()),$e=e;ae=E.default=(0,we.default)((0,$e.jsx)("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"RemoveRedEye");var O={},Fe=d;Object.defineProperty(O,"__esModule",{value:!0});var oe=O.default=void 0,Be=Fe(x()),ze=e;oe=O.default=(0,Be.default)((0,ze.jsx)("path",{d:"M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5M2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1m18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1M11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1m0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1M5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0z"}),"LightMode");var V={},ke=d;Object.defineProperty(V,"__esModule",{value:!0});var W=V.default=void 0,Pe=ke(x()),We=e;W=V.default=(0,Pe.default)((0,We.jsx)("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning");var D={},Ae=d;Object.defineProperty(D,"__esModule",{value:!0});var A=D.default=void 0,Ee=Ae(x()),Oe=e;A=D.default=(0,Ee.default)((0,Oe.jsx)("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"}),"ErrorOutline");var H={},Ve=d;Object.defineProperty(H,"__esModule",{value:!0});var se=H.default=void 0,De=Ve(x()),He=e;se=H.default=(0,De.default)((0,He.jsx)("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person");var N={},Ne=d;Object.defineProperty(N,"__esModule",{value:!0});var ie=N.default=void 0,qe=Ne(x()),Le=e;ie=N.default=(0,qe.default)((0,Le.jsx)("path",{d:"M12 6c1.11 0 2-.9 2-2 0-.38-.1-.73-.29-1.03L12 0l-1.71 2.97c-.19.3-.29.65-.29 1.03 0 1.1.9 2 2 2m4.6 9.99-1.07-1.07-1.08 1.07c-1.3 1.3-3.58 1.31-4.89 0l-1.07-1.07-1.09 1.07C6.75 16.64 5.88 17 4.96 17c-.73 0-1.4-.23-1.96-.61V21c0 .55.45 1 1 1h16c.55 0 1-.45 1-1v-4.61c-.56.38-1.23.61-1.96.61-.92 0-1.79-.36-2.44-1.01M18 9h-5V7h-2v2H6c-1.66 0-3 1.34-3 3v1.54c0 1.08.88 1.96 1.96 1.96.52 0 1.02-.2 1.38-.57l2.14-2.13 2.13 2.13c.74.74 2.03.74 2.77 0l2.14-2.13 2.13 2.13c.37.37.86.57 1.38.57 1.08 0 1.96-.88 1.96-1.96V12C21 10.34 19.66 9 18 9"}),"Cake");var q={},Te=d;Object.defineProperty(q,"__esModule",{value:!0});var ne=q.default=void 0,Ue=Te(x()),Qe=e;ne=q.default=(0,Ue.default)((0,Qe.jsx)("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"}),"Home");var L={},Ge=d;Object.defineProperty(L,"__esModule",{value:!0});var le=L.default=void 0,Je=Ge(x()),Ke=e;le=L.default=(0,Je.default)((0,Ke.jsx)("path",{d:"M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7M2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2m4.31-.78 3.15 3.15.02-.16c0-1.66-1.34-3-3-3z"}),"VisibilityOff");var T={},Xe=d;Object.defineProperty(T,"__esModule",{value:!0});var ce=T.default=void 0,Ye=Xe(x()),Ze=e;ce=T.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff");var U={},et=d;Object.defineProperty(U,"__esModule",{value:!0});var de=U.default=void 0,tt=et(x()),rt=e;de=U.default=(0,tt.default)((0,rt.jsx)("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam");const Rt=({onAuthenticated:xe,scannedIdFaceDescriptor:C,scannedIdFaceImage:Q,extractedDocumentData:s,modelsLoaded:f,loadingError:at,hashVerificationError:ot})=>{console.log("FaceAuthentication: Received extractedDocumentData prop:",s);const[z,j]=i.useState(!1),[st,b]=i.useState(!1),[y,G]=i.useState(null),[h,I]=i.useState("no-face"),[p,fe]=i.useState(!0),[R,M]=i.useState(null),w=i.useRef(null),m=i.useRef(null),ue=()=>{fe(!p),p||I("no-face")};i.useEffect(()=>{(async()=>{try{await navigator.mediaDevices.getUserMedia({video:!0}),G(null)}catch{G("Camera access denied. Please allow access to your camera.")}})()},[]);const he=async l=>{const n=document.createElement("canvas"),u=n.getContext("2d");n.width=l.width,n.height=l.height,u.drawImage(l,0,0);const a=u.getImageData(0,0,n.width,n.height),v=new Uint8Array(a.width*a.height);for(let o=0;o<a.data.length;o+=4){const c=(a.data[o]+a.data[o+1]+a.data[o+2])/3;v[o/4]=c}const k=new Array(256).fill(0);for(let o=1;o<a.height-1;o++)for(let c=1;c<a.width-1;c++){const me=o*a.width+c,ve=v[me];let X=0,Y=0;for(let $=-1;$<=1;$++)for(let F=-1;F<=1;F++){if(F===0&&$===0)continue;const ge=(o+$)*a.width+(c+F),je=v[ge];X|=(je>=ve?1:0)<<Y,Y++}k[X]++}const K=(a.width-2)*(a.height-2);return k.map(o=>o/K).reduce((o,c)=>c>0?o-c*Math.log2(c):o,0)},J=i.useCallback(async()=>{var n;const l=(n=w.current)==null?void 0:n.video;if(!(!l||!f))try{const u=await ye(l).withFaceLandmarks();u.length===0?I("no-face"):u.length===1?I("one-face"):I("multiple-faces")}catch(u){console.error("Error during face detection:",u)}},[f]);i.useEffect(()=>(p&&f&&!y?(m.current&&clearInterval(m.current),m.current=setInterval(()=>{J()},500)):m.current&&(clearInterval(m.current),m.current=null),()=>{m.current&&clearInterval(m.current)}),[p,f,y,J]);const pe=async()=>{var l;if(!C){alert("No ID face data available for comparison. Please go back and scan your ID.");return}j(!0),b(!0),M(null);try{if(!((l=w.current)==null?void 0:l.video))throw new Error("Webcam not ready.");const u=w.current.getScreenshot(),a=new Image;a.src=u,a.onload=async()=>{try{const v=await Ce(a).withFaceLandmarks().withFaceDescriptor();if(!v){alert("No face detected in live feed. Please ensure your face is clearly visible."),j(!1),b(!1);return}if(await he(a)<.8){alert("Potential spoof detected. Authentication failed."),j(!1),b(!1);return}const P=new be(C,.6).findBestMatch(v.descriptor);console.log("Comparison result:",P.toString()),P.distance<.6?(M("match"),xe("User",{authenticated:!0,description:"Face matched with ID.",documentData:s}),alert("Face authentication successful! Face matched with document.")):(M("no-match"),alert("Face authentication failed. Live face does not match the document face."))}catch(v){console.error("Authentication/Comparison error:",v),alert("Authentication failed. An error occurred during face comparison. Please try again."),M("no-match")}finally{j(!1),b(!1)}},a.onerror=()=>{alert("Failed to load live image. Please try again."),j(!1),b(!1)}}catch(n){console.error("Image processing error for live feed:",n),alert("Failed to process live image for authentication. Please try again."),j(!1),b(!1)}},g=Ie();Re(g.breakpoints.down("sm"));const[it,nt]=i.useState(!1),[lt,ct]=i.useState(""),[dt,xt]=i.useState("info");return e.jsxs(t,{sx:{display:"flex",justifyContent:"center",alignItems:"flex-start",minHeight:"100vh",backgroundColor:g.palette.background.default,padding:"20px",gap:3,flexWrap:"wrap"},children:[e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:3,flex:1,minWidth:"300px",maxWidth:"400px"},children:[e.jsx(_,{sx:{boxShadow:3,borderRadius:"12px"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#333",fontWeight:"bold",borderBottom:"2px solid #006FB9",paddingBottom:"8px",marginBottom:"16px"},children:"Document Face"}),Q?e.jsxs(t,{sx:{textAlign:"center",mb:2},children:[e.jsx("img",{src:Q,alt:"Scanned ID Face",style:{maxWidth:"120px",maxHeight:"120px",borderRadius:"50%",border:"3px solid #006FB9",boxShadow:"0 4px 8px rgba(0,0,0,0.1)"}}),e.jsx(r,{variant:"body2",sx:{mt:1,color:"text.secondary"},children:"Face extracted from ID"})]}):e.jsx(Z,{severity:"warning",children:"No document face found. Please go back to the previous step."})]})}),e.jsx(_,{sx:{boxShadow:3,borderRadius:"12px"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#333",fontWeight:"bold",borderBottom:"2px solid #006FB9",paddingBottom:"8px",marginBottom:"16px"},children:"Document Information"}),s?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(se,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsxs(t,{children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",fontSize:"12px"},children:"Full Name"}),e.jsx(r,{variant:"body1",sx:{fontWeight:"500"},children:s.name!=="Not found"?s.name:"Not available"})]})]}),e.jsx(te,{}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ie,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsxs(t,{children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",fontSize:"12px"},children:"Date of Birth"}),e.jsx(r,{variant:"body1",sx:{fontWeight:"500"},children:s.dob!=="Not found"?s.dob:"Not available"}),s.age!=="Not found"&&e.jsx(r,{variant:"body2",sx:{color:s.age>=18?"#00C853":"#f44336",fontSize:"11px",fontWeight:"bold"},children:s.age>=18?`✓ User is above 18 and verified (${s.age} years)`:`✗ User is below 18 (${s.age} years)`})]})]}),e.jsx(te,{}),e.jsxs(t,{sx:{display:"flex",alignItems:"flex-start",gap:1},children:[e.jsx(ne,{sx:{color:"#006FB9",fontSize:"20px",mt:.5}}),e.jsxs(t,{children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",fontSize:"12px"},children:"Permanent Address"}),e.jsx(r,{variant:"body1",sx:{fontWeight:"500",lineHeight:1.4},children:s.address!=="Not found"?s.address:"Not available"})]})]})]}):e.jsx(Z,{severity:"info",children:"No document information available. Please scan your ID first."})]})}),e.jsx(_,{sx:{boxShadow:3,borderRadius:"12px"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#333",fontWeight:"bold",borderBottom:"2px solid #006FB9",paddingBottom:"8px",marginBottom:"16px"},children:"Authentication Status"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1,border:"2px solid",borderColor:f?"#00C853":"orange",borderRadius:"8px",padding:"10px",backgroundColor:f?g.palette.mode==="dark"?"rgba(0, 200, 83, 0.1)":"#f1f8e9":g.palette.mode==="dark"?"rgba(255, 152, 0, 0.1)":"#fff8e1"},children:f?e.jsxs(t,{sx:{color:"#00C853",display:"flex",alignItems:"center"},children:[e.jsx(B,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Models Loaded"})]}):e.jsxs(t,{sx:{color:"orange",display:"flex",alignItems:"center"},children:[e.jsx(ee,{size:20,sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Loading models..."})]})}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1,border:"2px solid",borderColor:h==="no-face"?"red":h==="multiple-faces"?"orange":"#00C853",borderRadius:"8px",padding:"10px",backgroundColor:h==="no-face"?"#ffebee":h==="multiple-faces"?"#fff8e1":"#f1f8e9"},children:[h==="no-face"&&e.jsxs(t,{sx:{color:"red",display:"flex",alignItems:"center"},children:[e.jsx(W,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"No face detected"})]}),h==="multiple-faces"&&e.jsxs(t,{sx:{color:"orange",display:"flex",alignItems:"center"},children:[e.jsx(W,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Multiple faces detected"})]}),h==="one-face"&&e.jsxs(t,{sx:{color:"#00C853",display:"flex",alignItems:"center"},children:[e.jsx(B,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Ready to authenticate"})]})]}),R&&e.jsx(t,{sx:{display:"flex",alignItems:"center",gap:1,border:"2px solid",borderColor:R==="match"?"#00C853":"red",borderRadius:"8px",padding:"10px",backgroundColor:R==="match"?g.palette.mode==="dark"?"rgba(0, 200, 83, 0.1)":"#f1f8e9":g.palette.mode==="dark"?"rgba(244, 67, 54, 0.1)":"#ffebee"},children:R==="match"?e.jsxs(t,{sx:{color:"#00C853",display:"flex",alignItems:"center"},children:[e.jsx(B,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Face Match Successful!"})]}):e.jsxs(t,{sx:{color:"red",display:"flex",alignItems:"center"},children:[e.jsx(A,{sx:{mr:1}}),e.jsx(r,{variant:"body2",children:"Face Match Failed"})]})})]})]})})]}),e.jsx(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:3,flex:1,minWidth:"400px",maxWidth:"500px"},children:e.jsx(_,{sx:{boxShadow:3,borderRadius:"12px",width:"100%"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#333",fontWeight:"bold",borderBottom:"2px solid #006FB9",paddingBottom:"8px",marginBottom:"16px",textAlign:"center"},children:"Live Face Authentication"}),y?e.jsxs(t,{sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"300px",gap:1},children:[e.jsx(A,{sx:{color:"#c30010",fontSize:"50px"}}),e.jsx(r,{variant:"body2",sx:{color:"#c30010",textAlign:"center",fontWeight:"bold"},children:y})]}):e.jsx(t,{sx:{position:"relative",width:"100%",height:"300px",borderRadius:"16px",overflow:"hidden",boxShadow:2,border:"2px solid #006FB9",marginBottom:"16px"},children:p?e.jsx(_e,{ref:w,audio:!1,screenshotFormat:"image/jpeg",videoConstraints:{facingMode:"user"},style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(t,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",backgroundColor:g.palette.mode==="dark"?"rgba(255, 255, 255, 0.05)":"#f0f0f0"},children:e.jsx(r,{variant:"body1",color:"textSecondary",children:"Camera Disabled"})})}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx(re,{variant:"outlined",color:"secondary",onClick:ue,startIcon:p?e.jsx(ce,{}):e.jsx(de,{}),sx:{borderRadius:"12px",fontSize:"14px",padding:"8px 16px",textTransform:"none"},children:p?"Disable Camera":"Enable Camera"}),e.jsx(re,{variant:"contained",onClick:pe,disabled:z||y||h!=="one-face"||!p||!f||!C,startIcon:z?e.jsx(ee,{size:24}):e.jsx(Se,{}),sx:{borderRadius:"12px",fontSize:"16px",padding:"12px 24px",textTransform:"none",backgroundColor:"#006FB9","&:hover":{backgroundColor:"#005a9c"}},children:z?"Authenticating...":f?C?"Compare Faces":"Waiting for ID scan...":"Waiting for models..."})]})]})})}),e.jsx(t,{sx:{display:"flex",flexDirection:"column",gap:3,flex:1,minWidth:"280px",maxWidth:"320px"},children:e.jsx(_,{sx:{boxShadow:3,borderRadius:"12px"},children:e.jsxs(S,{children:[e.jsx(r,{variant:"h6",sx:{color:"#333",fontWeight:"bold",borderBottom:"2px solid #006FB9",paddingBottom:"8px",marginBottom:"16px"},children:"Instructions"}),e.jsxs(t,{sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ae,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsx(r,{variant:"body2",sx:{color:"#333"},children:"Look directly at your camera"})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(B,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsx(r,{variant:"body2",sx:{color:"#333"},children:"Position your face in the center"})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(oe,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsx(r,{variant:"body2",sx:{color:"#333"},children:"Ensure good lighting"})]}),e.jsxs(t,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(le,{sx:{color:"#006FB9",fontSize:"20px"}}),e.jsx(r,{variant:"body2",sx:{color:"#333"},children:"Remove masks or sunglasses"})]})]})]})})})]})};export{Rt as default};
